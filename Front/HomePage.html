<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Home Page</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600">
    <!-- https://fonts.google.com/specimen/Open+Sans -->
    <link rel="stylesheet" href="css/fontawesome.min.css">
    <!-- https://fontawesome.com/ -->
    <link rel="stylesheet" href="css/fullcalendar.min.css">
    <!-- https://fullcalendar.io/ -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- https://getbootstrap.com/ -->
    <link rel="stylesheet" href="css/tooplate.css">
    <script type="text/javascript" src="https://unpkg.com/webcam-easy@1.0.5/dist/webcam-easy.min.js"></script>
    <script type="text/javascript" src="jsmpeg.min.js"></script>


</head>

<body id="HomePage">
<div class="" id="home">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <nav class="navbar navbar-expand-xl navbar-light bg-light">
                    <a class="navbar-brand" href="HomePage.html">
                        <img src="https://drive.google.com/uc?export=view&id=1kkZJ8XDbzRaSASbTxIuh6ghQ2fEZ-3XN"
                             width="70" height="50">
                        <h1 class="tm-site-title mb-0">HAWK</h1>
                    </a>
                    <button class="navbar-toggler ml-auto mr-0" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav mx-auto">
                            <li class="nav-item">
                                <a class="nav-link" href="HomePage.html">Main
                                    <span class="sr-only">(current)</span>
                                </a>
                            </li>

                            <li class="nav-item">
                                <a class="nav-link" href="#">Cameras</a>
                            </li>

                            <li class="nav-item">
                                <a class="nav-link" href="#">Watchlist</a>
                            </li> 
                            
                            <li class="nav-item">
                            <a class="nav-link" href="List.html">Members</a>
                           </li>

                        </ul>
                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a class="nav-link d-flex" href="login.html">
                                    <i class="far fa-user mr-2 tm-logout-icon"></i>
                                    <span>Logout</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
        <!-- row -->
        <div class="row tm-content-row tm-mt-big">
            <div class="col col-8 ">
                <div class="bg-white tm-block h-100">
                    <h2 class="tm-block-title">In-Camera</h2>
                    <!-- <video autoplay="true" id="videoElement"src="rtsp://admin:Admin12!@192.168.1.64/cam0/mjpeg"> </video>-->
                    <canvas class="col col-12" id="video"></canvas>
                </div>
            </div>
           
            <div class="col col-4">
                <div class="bg-white tm-block h-100">
                    <h2 class="tm-block-title d-inline-block">Hits <img id="xxx" src=""></h2>
                    <table class="table table-striped mt-3">
                        <tbody id="tableMembers">
                       
                        </tbody>
                    </table>
                </div>
            </div>

        </div>

    </div>
</div>

<script type="text/javascript">
    //var myInterval = setInterval(hitsSript);
    var canvas = document.getElementById('video');
    //var ws = new WebSocket("ws://192.168.88.174:9900");
    // var player = new jsmpeg(ws, {canvas:canvas, autoplay:true, audio:false, loop:true});
    var player = new JSMpeg.Player("ws://localhost:9900", {
        canvas: canvas,
        autoplay: true,
        audio: false,
        loop: true
    });
    function hitsSript() {
        let res;
        var jresult;
        var splitHits = "";
        var image;

        res = fetch("https://localhost:5001/HAWK/Camera/Match")
            .then(resultHits => resultHits.json())
            .then(resultHits => {
                    jresult = JSON.stringify(resultHits);

                    resultHits.map(obj => {
                        for (var x in obj.matchResults) {
                            fetch("https://localhost:5001/HAWK/WatchlistMember/getMemberFace?id=" + obj.matchResults[x].watchlistMemberId)
                                .then(resultHits => resultHits.json())
                                .then(resultHits => {
                                    jresult = JSON.stringify(resultHits);
                                    image = jresult;

                                    splitHits += "<tr><td><i class=\"fas\">";
                                    splitHits += "<img src=\'data:image/(png|jpg|jpeg);base64," +
                                        image.replaceAll("\"", " ") + "'width='90px'height='90px'><br>";
                                    splitHits += obj.matchResults[x].fullName + "<br>";
                                    splitHits += "Match Score: " + obj.matchResults[x].score + "</i></td></tr>";
                                    document.getElementById("tableMembers").innerHTML = splitHits;
                                });
                        }
                    });
                }
            );
    }

    var myInterval = setInterval(hitsSript, 1000);

    function xi() {

    }
</script>
</body>

</html>